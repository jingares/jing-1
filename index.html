<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¿Ÿè±¬&æ¿Ÿæ·¨çš„é›™æ ¸å¿ƒè§€æ¸¬ç«™</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¿Ÿè±¬&æ¿Ÿæ·¨çš„è§€æ¸¬ç«™</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .glass-card {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            box-shadow: 6px 6px 0px rgba(0, 0, 0, 0.05);
            border-radius: 1.5rem;
            transition: all 0.2s ease;
        }
        @keyframes starBlink {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(0.8); }
        }
        .pixel-star { display: inline-block; animation: starBlink 1.5s infinite; color: #fbbf24; }
        .payer-option { display: none; }
        .payer-label {
            display: flex; align-items: center; justify-content: center;
            padding: 12px 8px; border-radius: 12px; font-weight: 700; font-size: 13px;
            background: #f1f5f9; cursor: pointer; border: 2px solid transparent; transition: all 0.2s;
        }
        .payer-option:checked + .payer-label {
            background: #1e293b; color: white; border-color: #1e293b; transform: translateY(-2px);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .tag-pig { color: #f97316; background: #fff7ed; border-radius: 6px; padding: 2px 8px; }
        .tag-clean { color: #0ea5e9; background: #f0f9ff; border-radius: 6px; padding: 2px 8px; }
    </style>

    <script>
        var submitted = false;
       // é‡‘éŒ¢åˆ†é  (gid=1296893534)
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTp-3jXGhNPGZhYixtC9vJ1GFCyBYRqU856YVEkUXJaTpsnNg48N3AMPsvbuAicL9XEFS00ibi0Ioh9/pub?gid=1296893534&single=true&output=csv';

// é«”é­„åˆ†é  (gid=857338261)
const bodyCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTp-3jXGhNPGZhYixtC9vJ1GFCyBYRqU856YVEkUXJaTpsnNg48N3AMPsvbuAicL9XEFS00ibi0Ioh9/pub?gid=857338261&single=true&output=csv';

        
        let expenseChart;
        let bodyChart;

        window.handleIframeLoad = function() {
            if (submitted) {
                alert('âœ¨ ç´€éŒ„å­˜æª”æˆåŠŸï¼ âœ§*ï½¡Ù©(ËŠá—œË‹*)Ùˆâœ§*ï½¡ âœ¨');
                location.reload();
            }
        };

        // åˆå§‹åŒ–ï¼šåŒæ™‚æŠ“å–å…©ä»½è³‡æ–™
        window.onload = function() {
            fetchData();
            fetchBodyData();
            if(document.getElementById('body-date')) {
                document.getElementById('body-date').valueAsDate = new Date();
            }
        };

        // --- é‡‘éŒ¢æ•¸æ“šè™•ç† ---
        async function fetchData() {
            try {
                const response = await fetch(`${csvUrl}&t=${Date.now()}`);
                const data = await response.text();
                const rows = data.split('\n').filter(r => r.trim() !== "").slice(1);
                
                let totalSpent = 0, pigPaid = 0, cleanPaid = 0;
                let categoryData = {};
                let recentHtml = "";

                rows.forEach(r => {
                    const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.trim().replace(/"/g, ""));
                    const amt = parseFloat(c[1]) || 0;
                    totalSpent += amt;
                    if (c[5] !== "æ˜¯") {
                        if (c[3] === "æ¿Ÿè±¬") pigPaid += amt;
                        if (c[3] === "æ¿Ÿæ·¨") cleanPaid += amt;
                    }
                    categoryData[c[2]] = (categoryData[c[2]] || 0) + amt;
                });

                // æœ€è¿‘ç´€éŒ„è™•ç†
                [...rows].reverse().slice(0, 5).forEach(row => {
                    const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c.trim().replace(/"/g, ""));
                    const amt = parseFloat(cols[1]) || 0;
                    const isPig = cols[3] === "æ¿Ÿè±¬";
                    recentHtml += `
                        <div class="flex justify-between items-center py-4 border-b border-slate-50 last:border-0">
                            <div>
                                <div class="font-bold text-slate-700 text-sm">${cols[2]}</div>
                                <div class="text-[11px] text-slate-400">${cols[4]}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-black text-slate-800">$${amt.toLocaleString()}</div>
                                <span class="text-[10px] font-bold ${isPig?'tag-pig':'tag-clean'}">${cols[3]}</span>
                            </div>
                        </div>`;
                });

                document.getElementById('wallet-balance').innerText = (15000 - totalSpent).toLocaleString();
                document.getElementById('pig-reimbursement').innerText = '$' + pigPaid.toLocaleString();
                document.getElementById('clean-reimbursement').innerText = '$' + cleanPaid.toLocaleString();
                document.getElementById('recent-list').innerHTML = recentHtml || "å°šæœªæœ‰å‚³èªªç´€éŒ„";

                renderChart(categoryData, totalSpent);
            } catch (e) { console.error("é‡‘éŒ¢æ•¸æ“šè®€å–å¤±æ•—", e); }
        }

        // --- é«”é­„æ•¸æ“šè™•ç† ---
        async function fetchBodyData() {
            try {
                const response = await fetch(`${bodyCsvUrl}&t=${Date.now()}`);
                const data = await response.text();
                const rows = data.split('\n').filter(r => r.trim() !== "").slice(1);
                
                let pigData = [], cleanData = [];
                let labelsSet = new Set();

                rows.forEach(r => {
                    const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.trim().replace(/"/g, ""));
                    const date = c[1]; 
                    const user = c[4]; 
                    const weight = parseFloat(c[2]); 
                    
                    if (!isNaN(weight)) {
                        labelsSet.add(date);
                        if (user === "æ¿Ÿè±¬") pigData.push({x: date, y: weight});
                        if (user === "æ¿Ÿæ·¨") cleanData.push({x: date, y: weight});
                    }
                });

                const sortedLabels = Array.from(labelsSet).sort();
                renderBodyChart(sortedLabels, pigData, cleanData);
            } catch (e) { console.error("é«”é­„æ•¸æ“šè®€å–å¤±æ•—", e); }
        }

        // --- åœ–è¡¨ç¹ªè£½å‡½æ•¸ ---
        function renderChart(catData, grandTotal) {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            if (expenseChart) expenseChart.destroy();
            const colors = ['#818cf8', '#f87171', '#fbbf24', '#34d399', '#f472b6', '#cbd5e1'];
            expenseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(catData).map(k => `${k} (${((catData[k]/grandTotal)*100).toFixed(0)}%)`),
                    datasets: [{
                        data: Object.values(catData),
                        backgroundColor: colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, cutout: '75%',
                    plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, font: { weight: '700' } } } }
                }
            });
        }

        function renderBodyChart(labels, pigData, cleanData) {
            const ctx = document.getElementById('bodyChart').getContext('2d');
            if (bodyChart) bodyChart.destroy();
            bodyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        { label: 'æ¿Ÿè±¬ (kg)', data: pigData, borderColor: '#f97316', backgroundColor: '#f97316', tension: 0.3 },
                        { label: 'æ¿Ÿæ·¨ (kg)', data: cleanData, borderColor: '#0ea5e9', backgroundColor: '#0ea5e9', tension: 0.3 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { beginAtZero: false } }
                }
            });
        }

        function openTab(t) {
            document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('text-slate-900', 'bg-white', 'shadow-sm'));
            document.getElementById(t).classList.add('active');
            document.getElementById('btn-' + t).classList.add('text-slate-900', 'bg-white', 'shadow-sm');
        }
    </script>
</head>
<body class="pb-12 px-4">
    <header class="max-w-md mx-auto pt-8 pb-6">
        <div class="flex justify-between items-end mb-4">
            <div>
                <h1 class="text-2xl font-black tracking-tight text-slate-800">æ¿Ÿè±¬ & æ¿Ÿæ·¨çš„è§€æ¸¬ç«™ <span class="pixel-star">â˜…</span></h1>
                <p class="text-xs font-bold text-slate-400 mt-1 italic">ä¸€èµ·é–‹å•Ÿå†’éšªå§</p>
            </div>
            <div class="text-[24px]">ğŸ·ğŸ£</div>
        </div>
        <nav class="flex bg-slate-200/50 p-1 rounded-2xl gap-1">
            <button onclick="openTab('money')" id="btn-money" class="tab-btn flex-1 py-2 font-bold text-sm rounded-xl transition-all text-slate-900 bg-white shadow-sm">é‡‘éŒ¢</button>
            <button onclick="openTab('mission')" id="btn-mission" class="tab-btn flex-1 py-2 font-bold text-sm rounded-xl transition-all text-slate-500">ä»»å‹™</button>
            <button onclick="openTab('body')" id="btn-body" class="tab-btn flex-1 py-2 font-bold text-sm rounded-xl transition-all text-slate-500">é«”é­„</button>
        </nav>
    </header>

    <main class="max-w-md mx-auto space-y-6">
        <section id="money" class="tab-content active space-y-6">
            <div class="glass-card p-8 bg-gradient-to-br from-white to-slate-50">
                <div class="flex items-center gap-2 mb-2">
                    <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                    <h2 class="text-sm font-black text-slate-400 uppercase tracking-widest">å…±åŒéŒ¢åŒ…é¤˜é¡</h2>
                </div>
                <div class="flex items-baseline gap-1">
                    <span class="text-2xl font-black text-slate-400">$</span>
                    <span id="wallet-balance" class="text-6xl font-black tracking-tighter text-slate-800">...</span>
                </div>
            </div>
            <div class="glass-card p-8">
                <h3 class="text-sm font-black text-slate-700 mb-6 flex items-center gap-2">ğŸ“Š æ”¯å‡ºæ§‹æˆæ¯”ä¾‹</h3>
                <div class="h-64"><canvas id="expenseChart"></canvas></div>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div class="glass-card p-5 border-t-4 border-t-orange-400">
                    <p class="text-[11px] font-bold text-slate-400 mb-1">æ‡‰æ’¥çµ¦ / æ¿Ÿè±¬</p>
                    <p id="pig-reimbursement" class="text-xl font-black text-slate-800">$0</p>
                </div>
                <div class="glass-card p-5 border-t-4 border-t-sky-400">
                    <p class="text-[11px] font-bold text-slate-400 mb-1">æ‡‰æ’¥çµ¦ / æ¿Ÿæ·¨</p>
                    <p id="clean-reimbursement" class="text-xl font-black text-slate-800">$0</p>
                </div>
            </div>
            <div class="glass-card p-8">
                <h3 class="text-sm font-black text-slate-700 mb-4">ğŸ“œ æœ€è¿‘ 5 ç­†å†’éšªç´€éŒ„</h3>
                <div id="recent-list" class="space-y-1">è®€å–ä¸­...</div>
            </div>
            <div class="glass-card p-8">
                <h3 class="text-sm font-black text-slate-700 mb-6">âœï¸ æ–°å¢ç”Ÿæ´»é–‹éŠ·</h3>
              <form action="https://docs.google.com/forms/d/e/1FAIpQLSclx6w0XJ6R5Wn8_U1D6i8CjY9g4uI8K6L-m3A8O_fN3S8T6L/formResponse" 
      method="POST" target="hidden_iframe" onsubmit="submitted=true;">

                    <div class="space-y-6">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-[10px] font-black text-slate-400 mb-1 block">æ—¥æœŸ</label>
                                <input type="date" name="entry.2029544290" class="w-full bg-slate-100/50 border-0 p-3 rounded-xl font-bold text-sm focus:ring-2 focus:ring-slate-300 outline-none" required>
                            </div>
                            <div>
                                <label class="text-[10px] font-black text-slate-400 mb-1 block">é¡åˆ¥</label>
                                <select name="entry.1539739800" class="w-full bg-slate-100/50 border-0 p-3 rounded-xl font-bold text-sm outline-none">
                                    <option value="é£²é£Ÿ">ğŸ• é£²é£Ÿ</option><option value="æ—¥ç”¨">ğŸ§º æ—¥ç”¨</option>
                                    <option value="è¨­å‚™">ğŸ’» è¨­å‚™</option><option value="æ—…éŠ">âœˆï¸ æ—…éŠ</option>
                                    <option value="ç¤¾äº¤">ğŸ¥‚ ç¤¾äº¤</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="text-[10px] font-black text-slate-400 mb-1 block">é‡‘é¡</label>
                            <input type="number" name="entry.1782400014" placeholder="0" class="w-full bg-slate-100/50 border-0 p-4 rounded-xl font-black text-xl outline-none" required>
                        </div>
                        <div>
                            <label class="text-[10px] font-black text-slate-400 mb-2 block">ä»˜æ¬¾äºº</label>
                            <div class="grid grid-cols-3 gap-2">
                                <input type="radio" name="entry.1122156127" value="æ¿Ÿè±¬" id="p1" class="payer-option" required>
                                <label for="p1" class="payer-label">æ¿Ÿè±¬</label>
                                <input type="radio" name="entry.1122156127" value="æ¿Ÿæ·¨" id="p2" class="payer-option">
                                <label for="p2" class="payer-label">æ¿Ÿæ·¨</label>
                                <input type="radio" name="entry.1122156127" value="å…±åŒéŒ¢åŒ…" id="p3" class="payer-option">
                                <label for="p3" class="payer-label">å…±åŒ</label>
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-black shadow-lg hover:bg-slate-700 active:scale-95 transition-all text-sm tracking-widest">åoçˆ» å•Ÿå‹•å‚³é€ çˆ»oå</button>
                    </div>
                </form>
            </div>
        </section>

        <section id="mission" class="tab-content py-20 text-center font-bold text-slate-300">
            <span class="text-4xl">ğŸŒ«ï¸</span><br>è¿·éœ§å£Ÿç½©ï¼Œæš«æ™‚ç„¡æ³•é€²å…¥
        </section>

        <section id="body" class="tab-content space-y-6">
            <div class="glass-card p-6">
                <h3 class="text-sm font-black text-slate-700 mb-6">âš”ï¸ æˆ°é¬¥åŠ›é€²åŒ–æ›²ç·š</h3>
                <div class="h-64"><canvas id="bodyChart"></canvas></div>
            </div>
            <div class="glass-card p-8">
                <h3 class="text-sm font-black text-slate-700 mb-6">âœï¸ ç´€éŒ„ä»Šæ—¥é«”é­„</h3>
    <form action="https://docs.google.com/forms/d/e/1FAIpQLScyO1v5v9V4h-7XvU9V_S8L7T6R5b_k-P5hS_fN6R5bkpShs/formResponse" 
      method="POST" target="hidden_iframe" onsubmit="submitted=true;">

    <div class="space-y-5">
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label class="text-[10px] font-black text-slate-400 mb-1 block">æ—¥æœŸ</label>
                <input type="date" id="body-date" name="entry.50169000" class="w-full bg-slate-100/50 border-0 p-3 rounded-xl font-bold text-sm outline-none" required>
            </div>
            <div>
                <label class="text-[10px] font-black text-slate-400 mb-1 block">æ™‚æ®µ</label>
                <select name="entry.148108422" class="w-full bg-slate-100/50 border-0 p-3 rounded-xl font-bold text-sm outline-none">
                    <option value="æ—©">ğŸŒ… æ™¨é–“é‡æ¸¬</option>
                    <option value="æ™š">ğŸŒƒ ç¡å‰é‡æ¸¬</option>
                </select>
            </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label class="text-[10px] font-black text-slate-400 mb-1 block">æ¸¬é‡è€…</label>
                <select name="entry.1767857666" class="w-full bg-slate-100/50 border-0 p-3 rounded-xl font-bold text-sm outline-none">
                    <option value="æ¿Ÿè±¬">ğŸ· æ¿Ÿè±¬</option>
                    <option value="æ¿Ÿæ·¨">ğŸ£ æ¿Ÿæ·¨</option>
                </select>
            </div>
            <div>
                <label class="text-[10px] font-black text-slate-400 mb-1 block">é«”é‡ (kg)</label>
                <input type="number" step="0.1" name="entry.1350125792" placeholder="0.0" class="w-full bg-slate-100/50 border-0 p-3 rounded-xl font-bold outline-none" required>
            </div>
        </div>
        <div>
            <label class="text-[10px] font-black text-slate-400 mb-1 block">é«”è„‚ (%)</label>
            <input type="number" step="0.1" name="entry.2120037805" placeholder="0.0" class="w-full bg-slate-100/50 border-0 p-3 rounded-xl font-bold outline-none">
        </div>
        <button type="submit" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-black shadow-lg hover:bg-slate-700 active:scale-95 transition-all text-sm tracking-widest">åå¿ƒç™¢ç™¢çš„è‚Œä¹‚è‚‰ä¹‚ç·šä¹‚æ¢å</button>
    </div>
</form>



            </div>
        </section>
    </main>

    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" onload="handleIframeLoad()"></iframe>
</body>
</html>


400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .glass-card { background: #ffffff; border: 2px solid #e2e8f0; box-shadow: 6px 6px 0px rgba(0, 0, 0, 0.05); border-radius: 1.5rem; transition: all 0.2s ease; }
        .pixel-star { display: inline-block; animation: starBlink 1.5s infinite; color: #fbbf24; }
        @keyframes starBlink { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.3; transform: scale(0.8); } }
        .payer-option { display: none; }
        .payer-label { display: flex; align-items: center; justify-content: center; padding: 12px 8px; border-radius: 12px; font-weight: 700; font-size: 13px; background: #f1f5f9; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
        .payer-option:checked + .payer-label { background: #1e293b; color: white; transform: translateY(-2px); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .tag-pig { color: #f97316; background: #fff7ed; border-radius: 6px; padding: 2px 8px; }
        .tag-clean { color: #0ea5e9; background: #f0f9ff; border-radius: 6px; padding: 2px 8px; }
    </style>

    <script>
        var submitted = false;
        // è³‡æ–™ä¾†æº (CSV é€£çµ)
        const moneyUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTp-3jXGhNPGZhYixtC9vJ1GFCyBYRqU856YVEkUXJaTpsnNg48N3AMPsvbuAicL9XEFS00ibi0Ioh9/pub?gid=1296893534&single=true&output=csv';
        const bodyUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTp-3jXGhNPGZhYixtC9vJ1GFCyBYRqU856YVEkUXJaTpsnNg48N3AMPsvbuAicL9XEFS00ibi0Ioh9/pub?gid=857338261&single=true&output=csv';

        let moneyChart, bodyChart;

        // 1. ä¿®æ­£ï¼šæ–°å¢æŠ“å–è³‡æ–™çš„å‡½å¼
        async function fetchData() {
            try {
                const [moneyRes, bodyRes] = await Promise.all([fetch(moneyUrl), fetch(bodyUrl)]);
                const moneyCsv = await moneyRes.text();
                const bodyCsv = await bodyRes.text();
                processMoney(moneyCsv);
                processBody(bodyCsv);
            } catch (err) {
                console.error("è³‡æ–™è®€å–å¤±æ•—", err);
            }
        }

        window.handleIframeLoad = function() {
            if (submitted) {
                alert('âœ¨ ç´€éŒ„å­˜æª”æˆåŠŸï¼ âœ§*ï½¡Ù©(ËŠá—œË‹*)Ùˆâœ§*ï½¡ âœ¨');
                location.reload();
            }
        };

        function processMoney(csv) {
            const rows = csv.split('\n').filter(r => r.trim() !== "").slice(1);
            let income = 15000, totalExp = 0, pigOwed = 0, cleanOwed = 0;
            let catData = {}, recentHtml = "";

            rows.forEach(r => {
                const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.trim().replace(/"/g, ""));
                if (c.length < 2) return;
                const amt = parseFloat(c[1]) || 0;
                if (c[2] === "æ”¶å…¥") { income += amt; } 
                else {
                    totalExp += amt;
                    catData[c[2]] = (catData[c[2]] || 0) + amt;
                    if (c[5] !== "æ˜¯") {
                        if (c[3] === "æ¿Ÿè±¬") pigOwed += amt;
                        if (c[3] === "æ¿Ÿæ·¨") cleanOwed += amt;
                    }
                }
            });

            [...rows].reverse().slice(0, 5).forEach(row => {
                const c = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.trim().replace(/"/g, ""));
                recentHtml += `<div class="flex justify-between items-center py-3 border-b border-slate-50 last:border-0">
                    <div><div class="font-bold text-slate-700 text-sm">${c[2]}</div><div class="text-[10px] text-slate-400">${c[0]}</div></div>
                    <div class="text-right"><div class="font-black text-slate-800">$${parseFloat(c[1]).toLocaleString()}</div>
                    <span class="text-[9px] font-bold ${c[3]==='æ¿Ÿè±¬'?'tag-pig':'tag-clean'}">${c[3]}</span></div></div>`;
            });

            document.getElementById('wallet-balance').innerText = (income - totalExp).toLocaleString();
            document.getElementById('pig-reimbursement').innerText = '$' + pigOwed.toLocaleString();
            document.getElementById('clean-reimbursement').innerText = '$' + cleanOwed.toLocaleString();
            document.getElementById('recent-list').innerHTML = recentHtml || "å°šç„¡è³‡æ–™";
            renderMoneyChart(catData, totalExp);
        }

        function processBody(csv) {
            const rows = csv.split('\n').filter(r => r.trim() !== "").slice(1);
            let bodyData = rows.map(r => {
                const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.trim().replace(/"/g, ""));
                return { date: c[1], name: c[0], weight: parseFloat(c[3]), fat: parseFloat(c[4]) || null };
            }).filter(d => !isNaN(d.weight));

            if (bodyData.length > 0) {
                const latest = bodyData[bodyData.length - 1];
                document.getElementById('latest-weight').innerText = latest.weight.toFixed(1);
                const lastFat = bodyData.filter(d => d.fat).slice(-1)[0];
                if (lastFat) document.getElementById('latest-fat').innerText = lastFat.fat.toFixed(1);
                renderBodyChart(bodyData);
            }
        }

        function renderMoneyChart(catData, total) {
            const ctx = document.getElementById('expenseChart');
            if (moneyChart) moneyChart.destroy();
            moneyChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(catData),
                    datasets: [{ 
                        data: Object.values(catData), 
                        backgroundColor: ['#818cf8', '#f87171', '#fbbf24', '#34d399', '#f472b6'], 
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    cutout: '70%', 
                    plugins: { 
                        legend: { position: 'bottom', labels: { font: { size: 11, weight: '700' } } }
                    }
                }
            });
        }

        function renderBodyChart(data) {
            const ctx = document.getElementById('bodyChart');
            if (bodyChart) bodyChart.destroy();
            bodyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.slice(-10).map(d => d.date.split('-').slice(1).join('/')),
                    datasets: [
                        { label: 'é«”é‡(kg)', data: data.slice(-10).map(d => d.weight), borderColor: '#ef4444', tension: 0.4, yAxisID: 'y' },
                        { label: 'é«”è„‚(%)', data: data.slice(-10).map(d => d.fat), borderColor: '#3b82f6', borderDash: [5,5], tension: 0.4, yAxisID: 'y1', spanGaps: true }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { position: 'left' }, y1: { position: 'right', grid: { display: false } } } }
            });
        }

        function openTab(t) {
            document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('text-slate-900', 'bg-white', 'shadow-sm'));
            document.getElementById(t).classList.add('active');
            document.getElementById('btn-' + t).classList.add('text-slate-900', 'bg-white', 'shadow-sm');
        }

        window.onload = fetchData;
    </script>
</head>
<body class="pb-12 px-4">

    <header class="max-w-md mx-auto pt-8 pb-6 text-center">
        <h1 class="text-2xl font-black text-slate-800">æ¿Ÿè±¬ & æ¿Ÿæ·¨è§€æ¸¬ç«™ <span class="pixel-star">â˜…</span></h1>
        <nav class="flex bg-slate-200/50 p-1 rounded-2xl mt-6 gap-1">
            <button onclick="openTab('money')" id="btn-money" class="tab-btn flex-1 py-2 font-bold text-sm rounded-xl bg-white shadow-sm text-slate-900">ğŸ’° é‡‘éŒ¢</button>
            <button onclick="openTab('body')" id="btn-body" class="tab-btn flex-1 py-2 font-bold text-sm rounded-xl text-slate-500">ğŸ’ª é«”é­„</button>
        </nav>
    </header>

    <main class="max-w-md mx-auto">
        <section id="money" class="tab-content active space-y-6">
            <div class="glass-card p-8 bg-slate-900 text-white border-0 text-center">
                <p class="text-[10px] text-slate-400 tracking-widest mb-1">å…±åŒé ç®—é¤˜é¡</p>
                <div class="flex items-baseline justify-center gap-1">
                    <span class="text-2xl text-slate-500">$</span>
                    <span id="wallet-balance" class="text-6xl font-black tracking-tighter">...</span>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="glass-card p-5 border-t-4 border-t-orange-400">
                    <p class="text-[10px] font-bold text-slate-400">æ‡‰æ’¥ / æ¿Ÿè±¬</p>
                    <p id="pig-reimbursement" class="text-xl font-black">$0</p>
                </div>
                <div class="glass-card p-5 border-t-4 border-t-sky-400">
                    <p class="text-[10px] font-bold text-slate-400">æ‡‰æ’¥ / æ¿Ÿæ·¨</p>
                    <p id="clean-reimbursement" class="text-xl font-black">$0</p>
                </div>
            </div>

            <div class="glass-card p-6 h-64"><canvas id="expenseChart"></canvas></div>

            <div class="glass-card p-6">
                <h3 class="text-xs font-bold text-slate-400 mb-4 uppercase italic">ğŸ“œ æœ€è¿‘ 5 ç­†å†’éšª</h3>
                <div id="recent-list" class="space-y-1 text-sm">è®€å–ä¸­...</div>
            </div>

            <div class="glass-card p-8">
                <h3 class="text-sm font-black text-slate-700 mb-6 italic">âœï¸ ç´€éŒ„æ–°èŠ±è²»</h3>
                <form action="https://docs.google.com/forms/u/1/d/e/1FAIpQLSd3pRv9-m4Tkd0duGqCn3YkUb_cTYz2oP3GY5Ht5WwPOVG1KA/formResponse" method="POST" target="hidden_iframe" onsubmit="submitted=true;">
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <input type="date" name="entry.2029544290" class="bg-slate-100 p-3 rounded-xl font-bold text-sm outline-none" required>
                            <select name="entry.1539739800" class="bg-slate-100 p-3 rounded-xl font-bold text-sm outline-none">
                                <option value="é£²é£Ÿ">ğŸ• é£²é£Ÿ</option><option value="æ—¥ç”¨">ğŸ§º æ—¥ç”¨</option><option value="è¨­å‚™">ğŸ’» è¨­å‚™</option><option value="æ”¶å…¥">ğŸ§§ æ”¶å…¥</option>
                            </select>
                        </div>
                        <input type="number" name="entry.1782400014" placeholder="é‡‘é¡" class="w-full bg-slate-100 p-4 rounded-xl font-black text-xl outline-none" required>
                        <div class="grid grid-cols-3 gap-2">
                            <input type="radio" name="entry.1122156127" value="æ¿Ÿè±¬" id="m1" class="payer-option" required>
                            <label for="m1" class="payer-label">æ¿Ÿè±¬</label>
                            <input type="radio" name="entry.1122156127" value="æ¿Ÿæ·¨" id="m2" class="payer-option">
                            <label for="m2" class="payer-label">æ¿Ÿæ·¨</label>
                            <input type="radio" name="entry.1122156127" value="å…±åŒéŒ¢åŒ…" id="m3" class="payer-option">
                            <label for="m3" class="payer-label">å…±åŒ</label>
                        </div>
                        <button type="submit" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-black text-xs tracking-widest">åoçˆ» å•Ÿå‹•å‚³é€ çˆ»oå</button>
                    </div>
                </form>
            </div>
        </section>

        <section id="body" class="tab-content space-y-6">
            <div class="glass-card p-8 bg-slate-900 text-white border-0 text-center">
                <p class="text-[10px] text-slate-400 tracking-widest mb-1 uppercase">æˆ°é¬¥é€²åŒ–ç‹€æ…‹</p>
                <div class="flex items-baseline justify-center gap-1">
                    <span id="latest-weight" class="text-6xl font-black tracking-tighter">--.-</span>
                    <span class="text-xl font-bold text-slate-500">kg</span>
                </div>
                <div class="mt-4 text-sm font-bold text-slate-400">æœ€æ–°é«”è„‚ï¼š<span id="latest-fat" class="text-white">--.-</span>%</div>
            </div>

            <div class="glass-card p-6 h-64"><canvas id="bodyChart"></canvas></div>

            <div class="glass-card p-8">
                <h3 class="text-sm font-black text-slate-700 mb-6 italic">ğŸ“ ç™»éŒ„é€²åŒ–æ•¸å€¼</h3>
         <form action="https://docs.google.com/forms/e/1FAIpQLSf6he1iDoiMPdEYIM6lRDe2iAa86lYigpL6oejqCAKqC7nPSw/formResponse" method="POST" target="hidden_iframe" onsubmit="submitted=true;">
    <div class="space-y-4">
        <div class="grid grid-cols-2 gap-2">
            <input type="radio" name="entry.1767857666" value="æ¿Ÿè±¬" id="b1" class="payer-option" required>
            <label for="b1" class="payer-label">ğŸ· æ¿Ÿè±¬</label>
            <input type="radio" name="entry.1767857666" value="æ¿Ÿæ·¨" id="b2" class="payer-option">
            <label for="b2" class="payer-label">ğŸ§´ æ¿Ÿæ·¨</label>
        </div>

        <div class="relative">
            <input type="date" name="entry.50169000" class="w-full bg-slate-100 p-3 rounded-xl font-bold text-sm outline-none" required>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <input type="radio" name="entry.148108422" value="æ—©" id="t-am" class="payer-option" required>
            <label for="t-am" class="payer-label">â˜€ï¸ æ—©</label>
            <input type="radio" name="entry.148108422" value="æ™š" id="t-pm" class="payer-option">
            <label for="t-pm" class="payer-label">ğŸŒ™ æ™š</label>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="relative">
                <input type="number" step="0.1" name="entry.1350125792" placeholder="é«”é‡(kg)" class="w-full bg-slate-100 p-4 rounded-xl font-black text-lg outline-none" required>
            </div>
            <div class="relative">
                <input type="number" step="0.1" name="entry.2120037805" placeholder="é«”è„‚(%)" class="w-full bg-slate-100 p-4 rounded-xl font-black text-lg outline-none">
            </div>
        </div>

        <button type="submit" class="w-full bg-red-600 text-white py-4 rounded-2xl font-black text-xs tracking-widest uppercase shadow-lg active:scale-95 transition-all">
            åoçˆ» å•Ÿå‹•é€²åŒ–ç´€éŒ„ çˆ»oå
        </button>
    </div>
</form>
            </div>
        </section>
    </main>

    <iframe name="hidden_iframe" style="display:none;" onload="handleIframeLoad()"></iframe>
</body>
</html>
